<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (11.0.22) on Tue Mar 05 09:58:41 WET 2024 -->
<title>Overview</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="dc.created" content="2024-03-05">
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="jquery/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="script.js"></script>
<script type="text/javascript" src="jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="jquery/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="jquery/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="Overview";
        }
    }
    catch(err) {
    }
//-->
var pathtoroot = "./";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li class="navBarCell1Rev">Overview</li>
<li><a href="pt/gov/cartaodecidadao/package-summary.html">Package</a></li>
<li>Class</li>
<li><a href="overview-tree.html">Tree</a></li>
<li><a href="deprecated-list.html">Deprecated</a></li>
<li><a href="index-all.html">Index</a></li>
<li><a href="help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<main role="main">
<div class="contentContainer">
<div class="block"><h2 id="version-3-12-0">Version 3.12.0</h2>
<h3 id="java-sdk-examples-">Java SDK Examples.</h3>
<p>Make sure that the JNI library is explicitly loaded using the following code (this implements the wrapper functions for Java)</p>
<pre><code class="lang-java">package pteidsample;
import pt.gov.cartaodecidadao.*;
(...)
static {
    try {
        System.loadLibrary(<span class="hljs-string">"pteidlibj"</span>);
    } catch (UnsatisfiedLinkError e) {
        System.err.println(<span class="hljs-string">"Native code library failed to load. \n"</span> + e);
        System.<span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);
    }
}
</code></pre>
<p>Add the initialization and release function in a appropriate place inside your application</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SamplePTEID</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>) </span>{
        PTEID_ReaderSet.initSDK();
        (...)
        PTEID_ReaderSet.releaseSDK();
    }
}
</code></pre>
<p>Access to the card can be achieved as follows</p>
<pre><code class="lang-java">PTEID_EIDCard card<span class="hljs-comment">;</span>
PTEID_ReaderContext <span class="hljs-built_in">context</span><span class="hljs-comment">;</span>
PTEID_ReaderSet readerSet<span class="hljs-comment">;</span>
readerSet = PTEID_ReaderSet.<span class="hljs-keyword">instance();
</span>for( int i=<span class="hljs-number">0</span><span class="hljs-comment">; i &lt; readerSet.readerCount(); i++){</span>
    <span class="hljs-built_in">context</span> = readerSet.getReaderByNum(i)<span class="hljs-comment">;</span>
    if (<span class="hljs-built_in">context</span>.isCardPresent()){
        card = <span class="hljs-built_in">context</span>.getEIDCard()<span class="hljs-comment">;</span>
        (...)
    }
}
</code></pre>
<p>Another method of obtaining <code>card</code> is to use <code>getReader</code> directly as follows</p>
<pre><code class="lang-java">PTEID_ReaderContext readerContext = PTEID_ReaderSet.instance().getReader()<span class="hljs-comment">;</span>
PTEID_EIDCard card = readerContext.getEIDCard()<span class="hljs-comment">;</span>
</code></pre>
<h4 id="get-events-for-insertion-and-removal-of-cards">Get events for insertion and removal of cards</h4>
<p>The SDK allows to receive events when a card is inserted or removed using callbacks</p>
<ul>
<li>For that make sure to use <code>SetEventCallback</code> on <code>PTEID_ReaderContext</code> associated with the reader that you want to receive events</li>
</ul>
<pre><code class="lang-java"><span class="hljs-keyword">class</span> <span class="hljs-title">PteidCardCallback</span> <span class="hljs-title">implements</span> <span class="hljs-title">Callback</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cardEvent</span>(<span class="hljs-params"><span class="hljs-keyword">long</span> lRet, <span class="hljs-keyword">long</span> ulState, Object callbackData</span>) </span>{
        <span class="hljs-keyword">int</span> cardState = (<span class="hljs-keyword">int</span>)ulState &amp; <span class="hljs-number">0x0000FFFF</span>;
        <span class="hljs-keyword">int</span> eventCounter = ((<span class="hljs-keyword">int</span>)ulState) &gt;&gt; <span class="hljs-number">16</span>;
        System.err.println(<span class="hljs-string">"DEBUG: Card Event:"</span> + <span class="hljs-string">" cardState: "</span>+cardState + <span class="hljs-string">" Event Counter: "</span>+ eventCounter);
        <span class="hljs-keyword">if</span> ((cardState &amp; <span class="hljs-number">0x0100</span>) != <span class="hljs-number">0</span>) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Card inserted"</span>);
        }
        <span class="hljs-keyword">else</span> {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Card removed"</span>);
        }
    }
}
(...)
PTEID_ReaderSet readerSet = PTEID_ReaderSet.instance();
PTEID_ReaderContext context = readerSet.getReader();
context.SetEventCallback(<span class="hljs-keyword">new</span> PteidCardCallback(), <span class="hljs-literal">null</span>);
</code></pre>
<ul>
<li>The parameter <code>ulState</code> is a combination of two values<ol>
<li>event counter of the reader used</li>
<li>a flag that contains the state of the event received, i.e., inserted or removed </li>
</ol>
</li>
<li>The parameter <code>lRet</code> is an error code returned in case of failure (successful access to the reader returns 0)</li>
<li><code>callbackData</code> is a reference to the object associated with <code>SetEventCallback()</code></li>
</ul>
<h4 id="get-identification-information">Get identification information</h4>
<pre><code class="lang-java">(...)
PTEID_EIDCard card = <span class="hljs-built_in">context</span>.getEIDCard()<span class="hljs-comment">;</span>
PTEID_EId <span class="hljs-keyword">eid </span>= card.getID()<span class="hljs-comment">;</span>
String nome = <span class="hljs-keyword">eid.getGivenName();
</span>String nrCC = <span class="hljs-keyword">eid.getDocumentNumber();
</span>(...)
</code></pre>
<h4 id="use-contactless">Use Contactless</h4>
<p>To use the card&#39;s contactless interface, it is necessary to obtain the card&#39;s interface and its type, using <code>getCardContactInterface()</code> and <code>getCardType()</code> respectively.</p>
<pre><code class="lang-java">//Gets the Card Contact Interface <span class="hljs-literal">and</span> type
PTEID_CardType <span class="hljs-attr">cardType</span> = <span class="hljs-literal">null</span>;
PTEID_CardContactInterface <span class="hljs-attr">contactInterface</span> = <span class="hljs-literal">null</span>;

//Gets the Card Contact Interface <span class="hljs-literal">and</span> type
<span class="hljs-keyword">if</span>(readerContext.isCardPresent()){
    <span class="hljs-attr">contactInterface</span> = readerContext.getCardContactInterface();
    <span class="hljs-attr">cardType</span> = readerContext.getCardType();
}
</code></pre>
<p>After obtaining both the contact interface and type, if the contact interface is contactless and the card supports contactless<code>(PTEID_CardType.PTEID_CARDTYPE_IAS5)</code>, then PACE Authentication is required to use the card through the contactless interface. PACE Authentication is done through the <code>initPaceAuthentication</code> function.</p>
<pre><code class="lang-java">//<span class="hljs-keyword">If</span> the contactInterface <span class="hljs-keyword">is</span> contactless <span class="hljs-keyword">and</span> the card supports contactless <span class="hljs-keyword">then</span> authenticate <span class="hljs-keyword">with</span> PACE
<span class="hljs-keyword">if</span> (contactInterface == PTEID_CardContactInterface.PTEID_CARD_CONTACTLESS &amp;&amp; cardType ==  PTEID_CardType.PTEID_CARDTYPE_IAS5){
    Scanner <span class="hljs-keyword">in</span> = <span class="hljs-keyword">new</span> Scanner(System.<span class="hljs-keyword">in</span>);
    System.<span class="hljs-keyword">out</span>.print(<span class="hljs-string">"Insert the Card access number (CAN) for the card in use: "</span>);
    String can_str = <span class="hljs-keyword">in</span>.nextLine();
    eidCard.initPaceAuthentication(can_str, can_str.length(),  PTEID_CardPaceSecretType.PTEID_CARD_SECRET_CAN);
}
</code></pre>
<h4 id="get-citizen-picture-file">Get citizen picture file</h4>
<pre><code class="lang-java">(...)
PTEID_EIDCard card = <span class="hljs-built_in">context</span>.getEIDCard()<span class="hljs-comment">;</span>
PTEID_EId <span class="hljs-keyword">eid </span>= card.getID()<span class="hljs-comment">;</span>
PTEID_Photo photoObj = <span class="hljs-keyword">eid.getPhotoObj();
</span>PTEID_ByteArray praw = photoObj.getphotoRAW()<span class="hljs-comment">; // jpeg2000 format </span>
PTEID_ByteArray ppng = photoObj.getphoto()<span class="hljs-comment">; // PNG format</span>
(...)
</code></pre>
<h4 id="get-address-information">Get address information</h4>
<pre><code class="lang-java"><span class="hljs-symbol">PTEID_EIDCard</span> card<span class="hljs-comment">;</span>
<span class="hljs-symbol">PTEID_ulwrapper</span> triesLeft = new PTEID_ulwrapper(-<span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
<span class="hljs-symbol">PTEID_Address</span> <span class="hljs-keyword">address;
</span>(...)
<span class="hljs-symbol">PTEID_Pins</span> pins = card.getPins()<span class="hljs-comment">;</span>
<span class="hljs-symbol">PTEID_Pin</span> pin = pins.getPinByPinRef(PTEID_Pin.<span class="hljs-keyword">ADDR_PIN);
</span><span class="hljs-symbol">if</span> (pin.verifyPin(<span class="hljs-string">""</span>, triesLeft, true)){
    <span class="hljs-keyword">address </span>= card.getAddr()<span class="hljs-comment">;</span>
    <span class="hljs-keyword">String </span>countryCode = <span class="hljs-keyword">address.getCountryCode();
</span>    <span class="hljs-keyword">String </span>district = <span class="hljs-keyword">address.getDistrict();
</span>    <span class="hljs-keyword">String </span>municipality = <span class="hljs-keyword">address.getMunicipality();
</span>    <span class="hljs-keyword">String </span><span class="hljs-keyword">street </span>= <span class="hljs-keyword">address.getStreet();
</span>    (...)
}
</code></pre>
<h4 id="how-to-read-or-write-personal-notes">How to read or write personal notes</h4>
<p>The SDK allows to write or read notes. Read doesn&#39;t require any permission, however when writing the authentication pin needs to be requested. <strong>Only cards with CardType different than <code>PTEID_CardType.PTEID_CARDTYPE_IAS5</code>(CC2) can read and write notes.</strong></p>
<pre><code class="lang-java">PTEID_CardType cardType = <span class="hljs-literal">null</span>;
<span class="hljs-comment">//Gets the Card type</span>
<span class="hljs-keyword">if</span>(readerContext.isCardPresent()) {
    cardType = readerContext.getCardType();
}

PTEID_EIDCard card = context.getEIDCard();

<span class="hljs-keyword">if</span>(cardType != PTEID_CardType.PTEID_CARDTYPE_IAS5){
    <span class="hljs-comment">// read personal notes</span>
    <span class="hljs-keyword">String</span> pdata = card.getID().getPersoData();
    <span class="hljs-comment">// write personal notes</span>
    <span class="hljs-keyword">String</span> notes = “a few notes”;
    PTEID_ByteArray pb = <span class="hljs-keyword">new</span> <span class="hljs-type">PTEID_ByteArray</span>(notes.getBytes(), notes.getBytes().length);
    boolean bOk = card.writePersonalNotes(personalNotes, card.getPins().getPinByPinRef(PTEID_Pin.AUTH_PIN));
}
</code></pre>
<h2 id="signatures-with-eid-card-citizen-signature-certificate-">Signatures with eID card (citizen signature certificate)</h2>
<p>Make sure to initialize the underlying classes that will be used to sign documents, as follows</p>
<pre><code class="lang-java">PTEID_ReaderSet readerSet = PTEID_ReaderSet.instance()<span class="hljs-comment">;</span>
PTEID_ReaderContext readerContext = readerSet.getReader()<span class="hljs-comment">;</span>
pteidlibJava_Wrapper.setCompatReaderContext(readerContext)<span class="hljs-comment">;</span>
PTEID_EIDCard card = readerContext.getEIDCard()<span class="hljs-comment">;</span>
</code></pre>
<h4 id="how-to-sign-pdf-documents-pades-">How to sign PDF documents (PAdES)</h4>
<pre><code class="lang-java"><span class="hljs-comment">//Select the location of visible signature in the document.</span>
<span class="hljs-comment">//X and Y coordinates of the signature location as percentage of page width and height [0-1]</span>
<span class="hljs-comment">//To apply an invisible signature negative values should be specified for both parameters, e.g. -1</span>
<span class="hljs-keyword">double</span> location_x = <span class="hljs-number">0.2</span>;
<span class="hljs-keyword">double</span> location_y = <span class="hljs-number">0.2</span>;
<span class="hljs-keyword">int</span> page = <span class="hljs-number">1</span>;

<span class="hljs-keyword">String</span> location = <span class="hljs-string">"Lisbon, Portugal"</span>; 
<span class="hljs-keyword">String</span> reason = <span class="hljs-string">"I agree with the content of this document"</span>;

<span class="hljs-comment">/* Signature profile according to PAdES specification
PAdES-B:   PTEID_SignatureLevel.PTEID_LEVEL_BASIC (default level)
PAdES-T:   PTEID_SignatureLevel.PTEID_LEVEL_TIMESTAMP
PAdES-LT:  PTEID_SignatureLevel.PTEID_LEVEL_LT
PAdES-LTA: PTEID_SignatureLevel.PTEID_LEVEL_LTV */</span>
signature.setSignatureLevel(PTEID_SignatureLevel.PTEID_LEVEL_BASIC);


<span class="hljs-comment">//jpeg_data is a byte[] containing a JPEG image file with recommended dimensions 351x77 px</span>
PTEID_ByteArray image_data = <span class="hljs-keyword">new</span> PTEID_ByteArray(jpeg_data, jpeg_data.length);
signature.setCustomImage(image_data);

<span class="hljs-comment">// Signing a batch of documents with only one PIN prompt</span>
PTEID_PDFSignature signature = <span class="hljs-keyword">new</span> PTEID_PDFSignature();
<span class="hljs-keyword">String</span>[] files = <span class="hljs-keyword">new</span> <span class="hljs-keyword">String</span>[] {<span class="hljs-string">'/home/user/document.pdf'</span>, <span class="hljs-string">'/home/user/another_document.pdf'</span>};
<span class="hljs-built_in">for</span> (<span class="hljs-keyword">String</span> inputFile : files) {
    signature.addToBatchSigning(inputFile);
}
<span class="hljs-keyword">String</span> output = <span class="hljs-string">'home/user/signed_documents/'</span>;

<span class="hljs-comment">// sign only one document</span>
PTEID_PDFSignature signature = <span class="hljs-keyword">new</span> PTEID_PDFSignature(<span class="hljs-string">'/home/user/document.pdf'</span>);
<span class="hljs-keyword">String</span> output = <span class="hljs-string">'home/user/document_signed.pdf'</span>;

<span class="hljs-comment">// Perform the actual signature</span>
<span class="hljs-keyword">int</span> returnCode = card.SignPDF(signature, page, location_x, location_y, location, reason, output);
</code></pre>
<h4 id="how-to-sign-any-type-of-file-xades-signature-format-">How to sign any type of file (XAdES signature format)</h4>
<pre><code class="lang-java">(...)
String[] <span class="hljs-keyword">files</span> = new String[] {<span class="hljs-string">'/home/user/file1.txt'</span>, <span class="hljs-string">'/home/user/file2.txt'</span>};

<span class="hljs-comment">// signing each file individually creating multiple signed files</span>
String output = <span class="hljs-string">'/home/user/signed_folder'</span>;
<span class="hljs-keyword">card</span>.SignXadesIndividual(output, <span class="hljs-keyword">files</span>, <span class="hljs-keyword">files</span>.length);

<span class="hljs-comment">// combining all files resulting in a single signed file</span>
String output = <span class="hljs-string">'home/user/signed_file.zip'</span>;
<span class="hljs-keyword">card</span>.SignXades(output, <span class="hljs-keyword">files</span>, <span class="hljs-keyword">files</span>.length);
</code></pre>
<p>The SDK also supports other XAdES signature profiles such as signature with timestamp <code>SignXadesT()</code> or archival <code>SignXadesA()</code>, etc..
For more details see at <a href="./classpt_1_1gov_1_1cartaodecidadao_1_1PTEID__EIDCard.html">PTEID_EIDCard</a> </p>
<h5 id="timestamp-server-configuration">Timestamp Server configuration</h5>
<p>The SDK allows to configure timestamp server instead of default one (which is limited to 20 requests to 20 minutes).
For example, to change the Time Stamping Authority (TSA) by changing the url or the server request timeout, as follows</p>
<pre><code class="lang-java">PTEID_Config <span class="hljs-built_in">config</span> = <span class="hljs-keyword">new</span> PTEID_Config(PTEID_PARAM_XSIGN_TSAURL);
<span class="hljs-built_in">config</span>.setString(<span class="hljs-string">"http://sha256timestamp.ws.symantec.com/sha256/timestamp"</span>); <span class="hljs-comment">//use a third party TSA</span>
</code></pre>
<h4 id="verify-a-pades-signature">Verify a PAdES signature</h4>
<p>One can verify the a PDF signature using the iText SDK.
See <a href="https://github.com/itext/i7js-samples/tree/master/publications/signatures/src/test/java/com/itextpdf/samples/signatures/chapter05">iText-example</a> for a concrete example of how to verify a signature.</p>
<h4 id="verify-a-xades-signature">Verify a XAdES signature</h4>
<p>One can use the library <a href="https://github.com/esig/dss/tree/master/dss-xades">DSS-Xades</a>  to validate a XAdES signature.</p></div>
</div>
<div class="contentContainer">
<table class="overviewSummary">
<caption><span>Packages</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Package</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor" id="i0">
<th class="colFirst" scope="row"><a href="pt/gov/cartaodecidadao/package-summary.html">pt.gov.cartaodecidadao</a></th>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</main>
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li class="navBarCell1Rev">Overview</li>
<li><a href="pt/gov/cartaodecidadao/package-summary.html">Package</a></li>
<li>Class</li>
<li><a href="overview-tree.html">Tree</a></li>
<li><a href="deprecated-list.html">Deprecated</a></li>
<li><a href="index-all.html">Index</a></li>
<li><a href="help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</body>
</html>
